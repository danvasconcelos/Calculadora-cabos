<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dimensionador de Cabos de AÃ§o - NBR ISO 2408</title>

    <script src="https://cdn.tailwindcss.com"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        body { font-family: 'Inter', sans-serif; }
    </style>
</head>

<body class="bg-slate-900 p-4 min-h-screen flex items-center justify-center">

<div class="max-w-md w-full bg-white rounded-3xl shadow-2xl overflow-hidden" id="app-container">

    <div class="bg-blue-600 p-6 text-white text-center">
        <h1 class="text-xl font-bold uppercase tracking-wider">
            Dimensionamento de Cabo
        </h1>
        <p class="text-xs text-blue-100 mt-1 opacity-80">
            CÃ¡lculo Base: NBR ISO 2408 | Fator de SeguranÃ§a 5:1
        </p>
    </div>

    <div class="p-6 space-y-5">

        <div>
            <label class="block text-xs font-black text-gray-500 uppercase mb-1">
                Peso da Carga (kgf)
            </label>
            <input type="number" id="pesoCarga" placeholder="Ex: 2500"
                class="w-full p-4 bg-gray-50 border-2 border-gray-100 rounded-xl
                       focus:border-blue-500 outline-none text-xl font-bold transition-all">
        </div>

        <div class="grid grid-cols-2 gap-4">
            <div>
                <label class="block text-xs font-black text-gray-500 uppercase mb-1">
                    NÂº de Pernas
                </label>
                <select id="pernas"
                    class="w-full p-3 bg-gray-50 border-2 border-gray-100 rounded-xl
                           outline-none focus:border-blue-500 font-semibold">
                    <option value="1">1 Perna</option>
                    <option value="2" selected>2 Pernas</option>
                    <option value="4">4 Pernas</option>
                </select>
            </div>

            <div>
                <label class="block text-xs font-black text-gray-500 uppercase mb-1">
                    Ã‚ngulo (Vertical)
                </label>
                <select id="angulo"
                    class="w-full p-3 bg-gray-50 border-2 border-gray-100 rounded-xl
                           outline-none focus:border-blue-500 font-semibold">
                    <option value="0">0Â° (Vertical)</option>
                    <option value="30">30Â°</option>
                    <option value="45">45Â°</option>
                    <option value="60">60Â° (Limite)</option>
                </select>
            </div>
        </div>

        <div>
            <label class="block text-xs font-black text-gray-500 uppercase mb-1">
                Tipo de Alma
            </label>
            <div class="flex gap-2">
                <button onclick="setAlma('AF')" id="btnAF"
                    class="flex-1 py-3 bg-blue-600 text-white rounded-xl font-bold shadow-md transition-all">
                    Fibra (AF)
                </button>
                <button onclick="setAlma('AA')" id="btnAA"
                    class="flex-1 py-3 bg-gray-200 text-gray-600 rounded-xl font-bold transition-all">
                    AÃ§o (AA)
                </button>
            </div>
        </div>

        <button onclick="recomendarCabo()"
            class="w-full bg-blue-600 hover:bg-blue-700 text-white font-black py-4
                   rounded-2xl shadow-lg transition-transform active:scale-95">
            VERIFICAR CABO IDEAL
        </button>

        <div id="resultadoCard"
             class="hidden mt-4 p-6 rounded-2xl border-2 text-center transition-all">
            <p id="msgTopo" class="text-xs font-bold uppercase mb-1"></p>
            <h2 id="msgDiametro" class="text-4xl font-black"></h2>
            <p id="msgDetalhe" class="text-xs mt-2 opacity-80 leading-relaxed"></p>

            <button onclick="gerarPDF()" id="btnPDF"
                class="mt-6 w-full bg-gray-800 hover:bg-black text-white font-bold py-3 rounded-xl 
                       transition-all flex items-center justify-center gap-2">
                <span>ðŸ“¥</span> SALVAR RELATÃ“RIO PDF
            </button>
        </div>

    </div>
</div>

<script>
let almaSelecionada = 'AF';

// Dados: [Carga de Ruptura MÃ­nima kgf, Polegadas]
const tabelas = {
    AF: {
        "6.4": [2320, "1/4\""], "8.0": [3610, "5/16\""], "9.5": [5080, "3/8\""],
        "11.5": [7410, "7/16\""], "13.0": [9480, "1/2\""], "14.5": [11700, "9/16\""],
        "16.0": [14300, "5/8\""], "19.0": [20100, "3/4\""], "22.0": [26900, "7/8\""],
        "26.0": [37400, "1\""]
    },
    AA: {
        "6.4": [2500, "1/4\""], "8.0": [3880, "5/16\""], "9.5": [5460, "3/8\""],
        "11.5": [7960, "7/16\""], "13.0": [10200, "1/2\""], "14.5": [12600, "9/16\""],
        "16.0": [15400, "5/8\""], "19.0": [21600, "3/4\""], "22.0": [28900, "7/8\""],
        "26.0": [40200, "1\""]
    }
};

function setAlma(tipo) {
    almaSelecionada = tipo;
    const btnAF = document.getElementById('btnAF');
    const btnAA = document.getElementById('btnAA');

    if (tipo === 'AF') {
        btnAF.className = 'flex-1 py-3 bg-blue-600 text-white rounded-xl font-bold shadow-md transition-all';
        btnAA.className = 'flex-1 py-3 bg-gray-200 text-gray-600 rounded-xl font-bold transition-all';
    } else {
        btnAA.className = 'flex-1 py-3 bg-blue-600 text-white rounded-xl font-bold shadow-md transition-all';
        btnAF.className = 'flex-1 py-3 bg-gray-200 text-gray-600 rounded-xl font-bold transition-all';
    }
}

function recomendarCabo() {
    const pesoVal = document.getElementById('pesoCarga').value;
    const pernas = parseInt(document.getElementById('pernas').value);
    const anguloDeg = parseInt(document.getElementById('angulo').value);
    const resCard = document.getElementById('resultadoCard');
    
    if (!pesoVal || pesoVal <= 0) {
        alert("Por favor, insira um peso vÃ¡lido.");
        return;
    }

    const peso = parseFloat(pesoVal);
    const fs = 5;

    // Fator de eficiÃªncia conforme Ã¢ngulo e nÃºmero de pernas
    // O cosseno reduz a capacidade conforme o Ã¢ngulo aumenta em relaÃ§Ã£o Ã  vertical
    const rad = anguloDeg * (Math.PI / 180);
    const fatorAngulo = Math.cos(rad);
    
    // Fatores de modo (Multiplicador de carga para lingas conforme normas de seguranÃ§a)
    const fatoresPernas = { 1: 1.0, 2: 1.4, 4: 2.1 };
    
    let recomendacao = null;

    // Procura na tabela o primeiro cabo que suporte a carga
    for (let diametro in tabelas[almaSelecionada]) {
        const [mbl, pol] = tabelas[almaSelecionada][diametro];
        
        // Capacidade AdmissÃ­vel (WLL) = (Ruptura / FS) * Fator de Pernas * Cosseno do Ã‚ngulo
        const wll = (mbl / fs) * (fatoresPernas[pernas] * fatorAngulo);

        if (wll >= peso) {
            recomendacao = { diametro, pol, wll, mbl };
            break;
        }
    }

    // ExibiÃ§Ã£o do Resultado
    resCard.classList.remove('hidden');
    const msgTopo = document.getElementById('msgTopo');
    const msgDiametro = document.getElementById('msgDiametro');
    const msgDetalhe = document.getElementById('msgDetalhe');
    const btnPDF = document.getElementById('btnPDF');

    if (recomendacao) {
        resCard.className = "mt-4 p-6 rounded-2xl border-2 text-center bg-green-50 border-green-200";
        msgTopo.innerText = "Cabo Recomendado";
        msgTopo.className = "text-xs font-bold uppercase mb-1 text-green-700";
        msgDiametro.innerText = `${recomendacao.diametro} mm (${recomendacao.pol})`;
        msgDiametro.className = "text-4xl font-black text-green-900";
        msgDetalhe.innerText = `Este cabo suporta atÃ© ${Math.round(recomendacao.wll)} kgf nesta configuraÃ§Ã£o (F.S. 5:1).`;
        btnPDF.style.display = "flex";
    } else {
        resCard.className = "mt-4 p-6 rounded-2xl border-2 text-center bg-red-50 border-red-200";
        msgTopo.innerText = "AtenÃ§Ã£o";
        msgTopo.className = "text-xs font-bold uppercase mb-1 text-red-700";
        msgDiametro.innerText = "Excedido";
        msgDiametro.className = "text-4xl font-black text-red-900";
        msgDetalhe.innerText = "Carga muito alta. Reduza o peso ou aumente o nÃºmero de pernas.";
        btnPDF.style.display = "none";
    }
}

async function gerarPDF() {
    const { jsPDF } = window.jspdf;
    const elemento = document.getElementById('resultadoCard');
    
    // Esconde o botÃ£o de PDF temporariamente para nÃ£o sair na "foto"
    const btn = document.getElementById('btnPDF');
    btn.style.opacity = "0";

    const canvas = await html2canvas(elemento, { 
        scale: 2,
        backgroundColor: "#F0FDF4" // Cor de fundo do card green-50
    });
    
    btn.style.opacity = "1";
    const imgData = canvas.toDataURL("image/png");
    const pdf = new jsPDF('p', 'mm', 'a4');
    
    // CabeÃ§alho do PDF
    pdf.setFontSize(16);
    pdf.setTextColor(0, 51, 153);
    pdf.text("RelatÃ³rio de Dimensionamento de Cabos", 105, 20, { align: "center" });
    
    pdf.setFontSize(10);
    pdf.setTextColor(100);
    pdf.text(`Data: ${new Date().toLocaleDateString('pt-BR')} | Norma: NBR ISO 2408`, 105, 28, { align: "center" });

    // InformaÃ§Ãµes TÃ©cnicas
    pdf.setFontSize(11);
    pdf.setTextColor(0);
    pdf.text(`Carga Informada: ${document.getElementById('pesoCarga').value} kgf`, 20, 45);
    pdf.text(`ConfiguraÃ§Ã£o: ${document.getElementById('pernas').value} perna(s) a ${document.getElementById('angulo').value}Â°`, 20, 52);
    pdf.text(`Tipo de Alma: ${almaSelecionada === 'AF' ? 'Fibra (AF)' : 'AÃ§o (AA)'}`, 20, 59);

    // Linha divisÃ³ria
    pdf.setDrawColor(200);
    pdf.line(20, 65, 190, 65);

    // Adiciona o card como imagem centralizada
    const imgProps = pdf.getImageProperties(imgData);
    const pdfWidth = 120;
    const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;
    pdf.addImage(imgData, "PNG", (210 - pdfWidth) / 2, 75, pdfWidth, pdfHeight);

    pdf.save("relatorio-cabo-de-aco.pdf");
}
</script>

</body>
</html>
